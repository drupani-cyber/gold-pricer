<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gold Treasure Custom Gold Estimate</title>

  <style>
    :root {
      --pad: 16px;
      --radius: 16px;
      --font: -apple-system, system-ui, "Segoe UI", Roboto, Arial, sans-serif;
      --blue: #0ea5e9;
      --red: #ef4444;
      --bg: #f6f7fb;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font);
      background: var(--bg);
      color: #0f172a;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 0;
      z-index: 20;
    }

    header .title {
      font-weight: 700;
      font-size: 1.25rem;
    }

    header img.logo-small {
      height: 60px;
      width: auto;
      object-fit: contain;
    }

    .wrap {
      max-width: 900px;
      margin: 20px auto 40px;
      padding: 0 10px;
    }

    .card {
      background: #ffffff;
      border-radius: 20px;
      padding: 22px 20px 26px;
      box-shadow: 0 18px 45px rgba(15,23,42,0.12);
    }

    .section-title {
      margin-top: 26px;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 1.05rem;
    }

    label {
      font-size: .9rem;
      font-weight: 500;
      display: block;
      margin-bottom: 4px;
    }

    input[type="number"], select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      font-family: var(--font);
    }

    input[type="number"]:focus, select:focus {
      outline: 2px solid var(--blue);
      border-color: var(--blue);
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .grid {
      display: grid;
      gap: 14px;
    }
    .g-3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
    .g-2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
    @media (max-width: 800px) {
      .g-3, .g-2 { grid-template-columns: 1fr; }
    }

    .guard {
      border: 3px solid var(--red);
      border-radius: 18px;
      padding: 14px 14px 18px;
      margin-top: 18px;
      position: relative;
    }
    .guard::before {
      content: "Fill only inside the red box";
      position: absolute;
      top: -10px;
      left: 18px;
      background: #fff;
      padding: 0 8px;
      color: var(--red);
      font-weight: 800;
      font-size: .8rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: .8rem;
      font-weight: 500;
      background: #fee2e2;
      color: #b91c1c;
    }
    .pill.ok {
      background: #dcfce7;
      color: #166534;
    }
    .pill.err {
      background: #fee2e2;
      color: #b91c1c;
    }

    .kv {
      display: flex;
      justify-content: space-between;
      margin: 4px 0;
    }

    .kv .label {
      font-size: .9rem;
      color: #4b5563;
    }

    .kv .value {
      font-variant-numeric: tabular-nums;
      font-weight: 600;
    }

    .kv .value.total {
      font-size: 1.25rem;
      color: var(--blue);
    }

    .btns {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
      margin-top: 20px;
    }
    button {
      padding: 12px;
      border-radius: 999px;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      font-family: var(--font);
    }

    button.primary   { background: var(--blue); color: #fff; border: none; }
    button.outline   { background: #fff; border: 2px solid var(--blue); color: var(--blue); }
    button.danger    { background: #fff; border: 2px solid var(--red); color: var(--red); }
    button.small     { padding: 6px 10px; font-size: .8rem; border-radius: 999px; }

    .checkbox-line {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: .9em;
      margin-top: 10px;
    }

    .muted { color: #6b7280; font-size: .9em; }

    /* PRINT LAYOUT */
    #printLayout { display: none; }
    #printLayout .logo {
      width: 140px;
      max-height: 90px;
      object-fit: contain;
    }
    #printLayout h1 {
      font-size: 22px;
      margin: 6px 0 2px;
      text-align: center;
    }
    #printLayout table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 14px;
    }
    #printLayout td {
      padding: 4px 0;
    }
    #printLayout td.right {
      text-align: right;
    }
    #printLayout .total {
      font-weight: 700;
      font-size: 16px;
    }

    /* Hide main app when printing, show print layout */
    @media print {
      header { display: none; }
      .wrap { margin: 0; padding: 0; }
      .card { box-shadow: none; border-radius: 0; padding: 0; }
      #app { display: none; }
      #printLayout { display: block !important; }
      body { background: #fff; }
    }
  </style>
</head>
<body>
<header>
  <div class="title">Gold Treasure Custom Gold Estimate</div>
  <a href="https://www.thegoldtreasure.com" target="_blank" rel="noopener noreferrer">
    <img class="logo-small" src="GoldTreasureLogo.jpg" alt="Gold Treasure Logo">
  </a>
</header>

<div class="wrap">
  <div class="card" id="app">
    <!-- TOP CONTROLS -->
    <div class="grid g-3">
      <div>
        <label for="spot">24K Spot Price (USD / oz)</label>
        <input id="spot" type="number" step="0.01" value="4100">
        <div class="muted" style="margin-top:4px;">Set once per day as needed.</div>
      </div>
      <div>
        <label for="labor">Labor $/g (editable)</label>
        <input id="labor" type="number" step="0.01" value="25">
      </div>
      <div>
        <label for="loss">Loss % on sold metal</label>
        <input id="loss" type="number" step="0.1" value="10">
      </div>
    </div>

    <!-- RED BOX: STAFF INPUT AREA -->
    <div class="guard">
      <div class="grid g-3">
        <div>
          <label for="karat">Karat</label>
          <select id="karat">
            <option value="10K" selected>10K</option>
            <option value="14K">14K</option>
          </select>
        </div>
        <div>
          <label for="weight">Product weight (g)</label>
          <input id="weight" type="number" step="0.01" value="">
        </div>
        <div>
          <label for="scrap10">Scrap given by customer 10K (g)</label>
          <input id="scrap10" type="number" step="0.01" value="">
        </div>
        <div>
          <label for="scrap14">Scrap given by customer 14K (g)</label>
          <input id="scrap14" type="number" step="0.01" value="">
        </div>
        <div>
          <label class="checkbox-line">
            <input type="checkbox" id="taxable" checked>
            <span>Taxable (8.25%)</span>
          </label>
        </div>
        <div>
          <label class="checkbox-line">
            <input type="checkbox" id="autosave" checked>
            <span>Autosave inputs</span>
          </label>
        </div>
      </div>
    </div>

    <!-- TOTALS -->
    <div class="section-title">Totals</div>
    <div class="grid">
      <div class="kv">
        <div class="label">Price of gold</div>
        <div class="value" id="priceGold">$0.00</div>
      </div>
      <div class="kv">
        <div class="label">Customer extra gold value</div>
        <div class="value" id="extraValue">$0.00</div>
      </div>
      <div class="kv">
        <div class="label">Labor</div>
        <div class="value" id="laborCost">$0.00</div>
      </div>
      <div class="kv">
        <div class="label">Subtotal</div>
        <div class="value" id="subtotal">$0.00</div>
      </div>
      <div class="kv">
        <div class="label">Tax 8.25%</div>
        <div class="value" id="tax">$0.00</div>
      </div>
      <div class="kv">
        <div class="label total">TOTAL DUE</div>
        <div class="value total" id="total">$0.00</div>
      </div>
    </div>

    <!-- small info line under totals, on screen only -->
    <p class="muted" id="screenMeta" style="margin-top:6px;text-align:center;"></p>

    <!-- BUTTONS -->
    <div class="btns">
      <button class="primary" id="btnCalc">Calculate</button>
      <button class="outline" id="btnClear">Clear</button>
      <button class="outline" id="btnPrint">Print</button>
      <button class="outline" id="btnPdf">Download PDF</button>
    </div>
  </div>

  <!-- PRINT-ONLY LAYOUT -->
  <div id="printLayout">
    <div style="text-align:center;">
      <a href="https://www.thegoldtreasure.com">
        <img class="logo" src="GoldTreasureLogo.jpg" alt="Gold Treasure Logo">
      </a>
      <h1>Gold Treasure Custom Gold Estimate</h1>
      <p style="margin:6px 0 4px;font-size:14px;text-align:center;">
        <strong>(956) 401-4010</strong><br>
        <strong>Date:</strong> <span id="pDate"></span><br>
        <strong>Quote valid for:</strong> 7 days<br>
        <strong>Visit us at:</strong> www.thegoldtreasure.com
      </p>
    </div>

    <table>
      <tbody>
        <tr>
          <td>Final weight</td>
          <td class="right">
            <span id="pFinalWeight">0.00</span> g
            <span id="pFinalKarat">10K</span>
          </td>
        </tr>
        <tr>
          <td>Scrap gold given by customer</td>
          <td class="right">
            10K: <span id="pScrap10">0.00</span> g &nbsp;&nbsp;
            14K: <span id="pScrap14">0.00</span> g
          </td>
        </tr>
        <tr>
          <td>Price of gold</td>
          <td class="right" id="pPriceGold">$0.00</td>
        </tr>
        <tr>
          <td>Customer extra gold value</td>
          <td class="right" id="pExtraValue">$0.00</td>
        </tr>
        <tr>
          <td>Labor</td>
          <td class="right" id="pLaborCost">$0.00</td>
        </tr>
        <tr>
          <td>Subtotal</td>
          <td class="right" id="pSubtotal">$0.00</td>
        </tr>
        <tr>
          <td>Tax 8.25%</td>
          <td class="right" id="pTax">$0.00</td>
        </tr>
        <tr>
          <td class="total">TOTAL DUE</td>
          <td class="right total" id="pTotal">$0.00</td>
        </tr>
      </tbody>
    </table>

    <p style="margin-top:24px;">Customer signature ______________________________</p>
  </div>
</div>

<script>
  const OZ_TO_GRAM = 31.1035;
  const PURITY_10 = 10 / 24;
  const PURITY_14 = 14 / 24;
  const TAX_RATE = 0.0825;

  const el = id => document.getElementById(id);

  const spotEl     = el("spot");
  const laborEl    = el("labor");
  const lossEl     = el("loss");
  const karatEl    = el("karat");
  const weightEl   = el("weight");
  const scrap10El  = el("scrap10");
  const scrap14El  = el("scrap14");
  const taxableEl  = el("taxable");
  const autosaveEl = el("autosave");

  const priceGoldEl  = el("priceGold");
  const extraValueEl = el("extraValue");
  const laborCostEl  = el("laborCost");
  const subtotalEl   = el("subtotal");
  const taxEl        = el("tax");
  const totalEl      = el("total");

  const pFinalWeightEl = el("pFinalWeight");
  const pFinalKaratEl  = el("pFinalKarat");
  const pScrap10El     = el("pScrap10");
  const pScrap14El     = el("pScrap14");
  const pPriceGoldEl   = el("pPriceGold");
  const pExtraValueEl  = el("pExtraValue");
  const pLaborCostEl   = el("pLaborCost");
  const pSubtotalEl    = el("pSubtotal");
  const pTaxEl         = el("pTax");
  const pTotalEl       = el("pTotal");
  const pDateEl        = el("pDate");
  const screenMetaEl   = el("screenMeta");

  function num(v) {
    const n = parseFloat(v);
    return isNaN(n) ? 0 : n;
  }

  function fmtMoney(x) {
    const sign = x < 0 ? "-" : "";
    const val = Math.abs(x).toFixed(2);
    return sign + "$" + val;
  }

  function saveState() {
    if (!autosaveEl.checked) return;
    const state = {
      spot: spotEl.value,
      labor: laborEl.value,
      loss: lossEl.value,
      karat: karatEl.value,
      weight: weightEl.value,
      scrap10: scrap10El.value,
      scrap14: scrap14El.value,
      taxable: taxableEl.checked
    };
    try {
      localStorage.setItem("goldTreasureState", JSON.stringify(state));
    } catch (e) {}
  }

  function loadState() {
    try {
      const txt = localStorage.getItem("goldTreasureState");
      if (!txt) return;
      const s = JSON.parse(txt);
      if ("spot" in s) spotEl.value = s.spot;
      if ("labor" in s) laborEl.value = s.labor;
      if ("loss" in s) lossEl.value = s.loss;
      if ("karat" in s) karatEl.value = s.karat;
      if ("weight" in s) weightEl.value = s.weight;
      if ("scrap10" in s) scrap10El.value = s.scrap10;
      if ("scrap14" in s) scrap14El.value = s.scrap14;
      if ("taxable" in s) taxableEl.checked = s.taxable;
    } catch (e) {}
  }

  function updateDateMeta() {
    const now = new Date();
    const opts = { year: "numeric", month: "long", day: "numeric" };
    const dateStr = now.toLocaleDateString("en-US", opts);
    if (pDateEl) pDateEl.textContent = dateStr;
    if (screenMetaEl) {
      screenMetaEl.textContent =
        "Date: " + dateStr + " · Quote valid for 7 days · Visit us at www.thegoldtreasure.com";
    }
  }

  function recalc() {
    const spot      = num(spotEl.value);      // 24K USD / oz
    const laborRate = num(laborEl.value);     // $ per gram
    const lossPct   = num(lossEl.value);      // %
    const karat     = karatEl.value;
    const weight    = Math.max(num(weightEl.value), 0);
    const scrap10   = Math.max(num(scrap10El.value), 0);
    const scrap14   = Math.max(num(scrap14El.value), 0);
    const taxable   = taxableEl.checked;

    // 24k $/g
    const price24_g = spot / OZ_TO_GRAM;

    // purity of finished piece
    const purityPiece = (karat === "14K") ? PURITY_14 : PURITY_10;

    // pure gold needed in piece (grams of fine gold)
    const pureNeeded = weight * purityPiece;

    // scrap: apply 10% loss on weight, then convert to pure
    const scrap10Adj = scrap10 * 0.9;
    const scrap14Adj = scrap14 * 0.9;

    const pureFromScrap =
      scrap10Adj * PURITY_10 +
      scrap14Adj * PURITY_14;

    // net pure gold required
    const netPure = pureNeeded - pureFromScrap;

    const pureNew    = Math.max(netPure, 0);   // we must supply this
    const extraPure  = Math.max(-netPure, 0);  // extra scrap we buy from customer

    // price per gram of pure gold when SELLING new metal (we add loss %)
    const pureSellRate      = price24_g * (1 + lossPct / 100);
    // price per gram of pure gold when BUYING extra scrap (80% of value)
    const pureBuyExtraRate  = price24_g * 0.8;

    // gold cost to customer (only on pureNew)
    const goldCost      = pureNew   * pureSellRate;
    // credit we owe the customer for extra scrap
    const extraCredit   = extraPure * pureBuyExtraRate;

    // labor charged on finished weight
    const laborCost     = weight * laborRate;

    // subtotal BEFORE tax – can be negative (we owe customer)
    let subtotalBeforeTax = goldCost + laborCost - extraCredit;

    // tax only on positive sale amount
    let tax = 0;
    if (taxable && subtotalBeforeTax > 0) {
      tax = subtotalBeforeTax * TAX_RATE;
    }
    const total = subtotalBeforeTax + tax;

    // Screen totals
    priceGoldEl.textContent  = fmtMoney(goldCost);
    extraValueEl.textContent = fmtMoney(extraCredit);
    laborCostEl.textContent  = fmtMoney(laborCost);
    subtotalEl.textContent   = fmtMoney(subtotalBeforeTax);
    taxEl.textContent        = fmtMoney(tax);
    totalEl.textContent      = fmtMoney(total);

    // Print layout values
    pFinalWeightEl.textContent = weight.toFixed(3);
    pFinalKaratEl.textContent  = karat;
    pScrap10El.textContent     = scrap10.toFixed(3);
    pScrap14El.textContent     = scrap14.toFixed(3);
    pPriceGoldEl.textContent   = fmtMoney(goldCost);
    pExtraValueEl.textContent  = fmtMoney(extraCredit);
    pLaborCostEl.textContent   = fmtMoney(laborCost);
    pSubtotalEl.textContent    = fmtMoney(subtotalBeforeTax);
    pTaxEl.textContent         = fmtMoney(tax);
    pTotalEl.textContent       = fmtMoney(total);

    saveState();
  }

  function doPrint() {
    window.print();
  }

  function doPdf() {
    doPrint(); // use browser "Save as PDF"
  }

  function clearAll() {
    weightEl.value  = "";
    scrap10El.value = "";
    scrap14El.value = "";
    karatEl.value   = "10K";
    taxableEl.checked = true;
    recalc();
  }

  // EVENT WIRES
  document.getElementById("btnCalc").addEventListener("click", recalc);
  document.getElementById("btnClear").addEventListener("click", clearAll);
  document.getElementById("btnPrint").addEventListener("click", doPrint);
  document.getElementById("btnPdf").addEventListener("click", doPdf);

  [spotEl, laborEl, lossEl, karatEl, weightEl, scrap10El, scrap14El, taxableEl]
    .forEach(input => input.addEventListener("change", recalc));

  // INIT
  loadState();
  updateDateMeta();
  recalc();
</script>
</body>
</html>
